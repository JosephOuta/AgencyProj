---
title: "Agency_analysis_final"
author: "Joseph"
date: "11/4/2020"
output: html_document
---

# Table of Contents
[Data preparation](#data-preparation)
[Data wrangling](#data-wrangling)
[Agency exclusions](#agency-exclusions)
[Non-Agency exclusions](#nonagency-exclusions)
[Exploratory analyses](#exploratory-analyses)
[Assumptions tests](#assumptions-of-anova)
[Confirmatory analysis - Two Way ANOVA](#confirmatory-analyses)
[Confirmatory analysis - Ordinal Logistic Regression](#ordinal-logistic-regression)

# Data Preparation

Load packages

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = normalizePath(".."))

library(tidyverse) # for data munging
library(knitr) 
library(rstatix)
library(ggpubr)
library(lme4)
library(lmerTest)
library(MASS) #for regression. #masks select from rstatix and dplyr...so specify using dplyr::select
library(hablar) #you need this for batch-converting to numeric

library(ordinal) #for clmm regression

dat <- read_csv("agendata.csv")

dat <- rename(dat, AttnCheck = "Debrief+attend") 
filter(dat, AttnCheck == 1 | AttnCheck == 2 | AttnCheck == 3 | AttnCheck == 4) #check who failed attn end check = 6 

```

# Data Wrangling

```{r cleaning and wrangling}
dat <- dat %>%
  dplyr::slice(3:length(dat$ResponseId)) %>% #remove first 2 rows with title info
  filter(Status==0) %>% #Remove Survey Preview rows
  arrange(Agency2) %>% #Arrange data by condition
  rename(ECNA = "Q51") %>%
  filter(AttnCheck==5) %>% #Exclude participants who failed attention end-check
  filter(!is.na(Agency2)|!is.na(NonA2)) %>%  #Exclude participants who left attention manipulation check blank
  convert(num(Sab1_1,Sab1_2, Sab1_3, Sab1_4,Sab1_5,
         Sab1b_1,Sab1b_2,Sab1b_3,Sab1b_4,Sab1b_5,
         Sab2_1,Sab2_2,Sab2_3,Sab2_4,Sab2_5,
         Sab2b_1,Sab2b_2,Sab2b_3,Sab2b_4,Sab2b_5,
         Sab3_1,Sab3_2,Sab3_3,Sab3_4,Sab3_5,
         Sab3b_1,Sab3b_2,Sab3b_3,Sab3b_4,Sab3b_5,
         EC,
         Sab1NA_1,Sab1NA_2,Sab1NA_3,Sab1NA_4,Sab1NA_5,
         Sab1NAb_1,Sab1NAb_2,Sab1NAb_3,Sab1NAb_4,Sab1NAb_5,
         Sab2NA_1,Sab2NA_2,Sab2NA_3,Sab2NA_4,Sab2NA_5,
         Sab2NAb_1,Sab2NAb_2,Sab2NAb_3,Sab2NAb_4,Sab2NAb_5,
         Sab3NA_1,Sab3NA_2,Sab3NA_3,Sab3NA_4,Sab3NA_5,
         Sab3NAb_1,Sab3NAb_2,Sab3NAb_3,Sab3NAb_4,Sab3NAb_5,
         ECNA,AttnCheck)) %>%
  mutate(condition = ifelse(is.na(Agency2),2,1)) %>% #create condition column first
  rowwise() %>%
  mutate(deserve.sab1 = ifelse(condition == 1,
                              sum(Sab1_1, Sab1_2, Sab1_3, Sab1_4, Sab1_5, na.rm = TRUE),
                              sum(Sab1NA_1, Sab1NA_2, Sab1NA_3, Sab1NA_4, Sab1NA_5, na.rm = TRUE))) %>%
  mutate(deserve.sab2 = ifelse(condition == 1,
                              sum(Sab2_1, Sab2_2, Sab2_3, Sab2_4, Sab2_5, na.rm = TRUE),
                              sum(Sab2NA_1, Sab2NA_2, Sab2NA_3, Sab2NA_4, Sab2NA_5, na.rm = TRUE))) %>%
  mutate(deserve.sab3 = ifelse(condition == 1,
                              sum(Sab3_1, Sab3_2, Sab3_3, Sab3_4, Sab3_5, na.rm = TRUE),
                              sum(Sab3NA_1, Sab3NA_2, Sab3NA_3, Sab3NA_4, Sab3NA_5, na.rm = TRUE))) %>%
  
  mutate(actual.sab1 = ifelse(condition == 1,
                              sum(Sab1b_1, Sab1b_2, Sab1b_3, Sab1b_4, Sab1b_5, na.rm = TRUE),
                              sum(Sab1NAb_1, Sab1NAb_2, Sab1NAb_3, Sab1NAb_4, Sab1NAb_5, na.rm = TRUE))) %>%
  mutate(actual.sab2 = ifelse(condition == 1,
                              sum(Sab2b_1, Sab2b_2, Sab2b_3, Sab2b_4, Sab2b_5, na.rm = TRUE),
                              sum(Sab2NAb_1, Sab2NAb_2, Sab2NAb_3, Sab2NAb_4, Sab2NAb_5, na.rm = TRUE))) %>%
  mutate(actual.sab3 = ifelse(condition == 1,
                              sum(Sab3b_1, Sab3b_2, Sab3b_3, Sab3b_4, Sab3b_5, na.rm = TRUE),
                              sum(Sab3NAb_1, Sab3NAb_2, Sab3NAb_3, Sab3NAb_4, Sab3NAb_5, na.rm = TRUE))) %>%
  dplyr::select(ResponseId, Agency2, NonA2, condition,
               deserve.sab1, deserve.sab2, deserve.sab3,
               actual.sab1, actual.sab2, actual.sab3)  #select condition and sum columns

```

Attention Exclusions 

### Agency Exclusions 

Excluding based on failed attention responses in Agency condition manipulation check (57 exclusions)

```{r}
dat <- dat %>%
  filter( # Exclusion 2: exclude failed condition 1 Attention Check
       !grepl("5", Agency2),
       # CODER 1 - JOSEPH OUTA
       !grepl("Balancing the Company's Needs and Employee Satisfaction", Agency2), #page 1
       !grepl("Based on the company values or mission statement", Agency2),
       !grepl("By the value", Agency2),
       !grepl("Company decisions should be based on values", Agency2),
       !grepl("Decisions will be all over the place and inconsistent.", Agency2),
       !grepl("Employees should make decisions based on values.", Agency2), #page 2 of preview
       !grepl("Employees should keep the big picture in mind. Not ever customer will be the same and they must respect them and handle them in a friendly manner.", Agency2), # page 3
       !grepl("Focus on customer care and well-being", Agency2), # page 4
       !grepl("It treats the costumer with professionalism", Agency2),  
       !grepl("Quality and respect", Agency2), #page 5
       !grepl("quickly and confidently", Agency2),
       !grepl("should make them respectfully and fairly", Agency2), #page 7
       !grepl("That they should do them with the best interests of the company in mind", Agency2),
       !grepl("They respect there policy", Agency2), #page 8
       !grepl("They should make decisions that the company would approve of and they themselves would approve of.", Agency2),
       !grepl("They should think about your value as a pets", Agency2), #page 9
       !grepl("They should try to be more friendly towards customers.", Agency2),
       !grepl("to serve the customer best", Agency2), #page 10
       !grepl("Treat customers in professional and friendly manner", Agency2),
       !grepl("treat employees well", Agency2),
       !grepl("Treat the customers well.", Agency2),
       !grepl("yes", Agency2), #page 11
       
       # CODER 2 - YUEL LI ADDITIONAL EXCLUSIONS
       !grepl("Allows customers to make company decisions", Agency2),
       !grepl("By working together", Agency2),
       !grepl("Employees of SerVest should be mindful of the different value's their customers might have.", Agency2),
       !grepl("Employees should make company decisions based on the values the company at large has, not their own.", Agency2),
       !grepl("Employees should make company decisions taking into account customer values.", Agency2),
       !grepl("Employees should make company decisions with the customer's best interest in mind. All decisions should benefit the customer first.", Agency2),
       !grepl("employees should make the best decisions for the customers", Agency2),
       !grepl("Employees should work together to make decisions.", Agency2),
       !grepl("Following their guidelines", Agency2),
       !grepl("How to best serve their interests.", Agency2),
       !grepl("I believe that when the company encourages people who do not agree with their beliefs to find another place to be serviced, it gives the employees more power to say who can and cannot shop there.", Agency2),
       !grepl("In a professional and caring manner", Agency2),
       !grepl("Sarvest trusts its employees to make good decisions", Agency2),
       !grepl("Servest relies on employees making good choices.", Agency2),
       !grepl("SerVest understands that company values vary and they trust companies to make their own decisions that reflect those.", Agency2),
       !grepl("That the company has certain values and also employees should also have those values and their own", Agency2),
       !grepl("They respect there policy", Agency2),
       !grepl("They should accomidate the customer's values", Agency2),
       !grepl("They should make decisions that the company would approve of and they themselves would approve of.", Agency2),
       !grepl("They should make decisions with the customers in mind", Agency2),
       !grepl("They should put customer service first.", Agency2),
       !grepl("They should reflect customer values", Agency2),
       !grepl("they take in mind what customers say", Agency2),
       !grepl("to reflect customer's beliefs", Agency2),
       !grepl("trust employee to make decisions that will reflect positively on the company", Agency2),
       !grepl("values reflect the work culture", Agency2),
       !grepl("with consideration of the customer needs", Agency2),
       !grepl("With morals & sincerity. SerVest trusts the employees", Agency2),
       !grepl("with the customer in mind", Agency2),
       !grepl("with the upmost integrity", Agency2)
       )

```

### NonAgency Exclusions

Excluding based on failed responses in Non-Agency condition manipulation check (32 exclusions)

```{r}

dat <- dat %>%
  filter(# CODER 1 - JOSEPH OUTA
         !grepl("By keeping a good relationship with the customer- honesty and respect.", NonA2), #page 1
         !grepl("Company decisions are basically based in how they treat their cliental.", NonA2),
         !grepl("Decisions should be made in a way that will serve the customers better", NonA2),
         !grepl("Do not understand the question", NonA2),
         !grepl("Employees should share their knowledge with others", NonA2),# page 3
         !grepl("employess should be involved with company decisions since everyone has different opinions", NonA2), #page 4
         !grepl("Ethical decisions", NonA2),
         !grepl("I cannot remember", NonA2),
         !grepl("im not aware", NonA2),
         !grepl("It denotes professionalism that isn't swayed by the person in charge's own views.", NonA2),
         !grepl("It says that Servest understands there are different personal values and trusts that those values will be reflected by you in the company.", NonA2),
         !grepl("iT SHOULD BE REAL", NonA2), #page 5
         !grepl("make them as a good decision", NonA2),
         !grepl("my values might clash with company values", NonA2),
         !grepl("Of course, they should think carefully and make a good decision", NonA2), #page 7
         !grepl("Of course, they should think carefully and make a good decision.", NonA2),
         !grepl("ok", NonA2),
         !grepl("SerVest does not discriminate.", NonA2), #page 8
         !grepl("should keep customer in mind", NonA2),
         !grepl("Should not use company's beliefs as part of personality", NonA2),
         !grepl("They are respectful and pay close attention to detail", NonA2), #page 9
         !grepl("they say you put the emotions of the customer into consideration", NonA2),
         !grepl("They should think about the customer more than themselves.", NonA2),#page 10
         !grepl("to the best", NonA2), #page 11
         !grepl("Trust themselves to not let their values be swayed", NonA2),
         !grepl("Value your privacy and your opinions.", NonA2),
         !grepl("varies", NonA2),
         !grepl("Vary depending on customer values", NonA2), #page 12
         !grepl("with responsibility", NonA2),
         !grepl("You should decide what to do", NonA2),
         
         # CODER 2 - YUE LI ADDITIONAL EXCLUSIONS
         !grepl("Employees Should be able to make their own decisions", NonA2),
         !grepl("information technogy company", NonA2),
         !grepl("It's Information Technogy", NonA2),
         !grepl("Like many companies, SerVest is committed to making sure customers are treated in a professional, friendly, and patient manner.", NonA2),
         !grepl("my values might conflict with the company's", NonA2) 
  )

```

# Exploratory Analyses

```{r}

# histogram of one of the factors
dat %>%
  ggplot(aes(x = deserve.sab1)) +
  geom_bar(width = 0.75) +
  scale_x_continuous(breaks = seq (from = 0, to = 5, by = 1))

dat <- dat %>%
  dplyr::select(ResponseId, condition,
         deserve.sab1, deserve.sab2, deserve.sab3,
         actual.sab1, actual.sab2, actual.sab3) %>%
  pivot_longer(-c("ResponseId", "condition"), names_to = "Key", values_to = "Behaviors") %>% #pivot long then separate
  separate(Key, c("Kind", "Sabotage")) %>% # splits Key into kind and sabotage 
  mutate_at(vars(condition), factor) %>%
  mutate_at(vars(Kind), factor) %>%
  mutate_at(vars(Sabotage), factor) 

# boxplot of unethical behaviors across all 3 IVs
dat %>% 
  ggplot(aes(x = condition, y = Behaviors,  color = Sabotage)) +
  geom_boxplot() #looks left skewed, makes sense since DV is Likert-type/ ordinal

# boxplot but binned by within-participant variable Sabotage
dat %>%
   ggplot(aes(x = Sabotage, y = Behaviors,  color = condition)) +
  geom_boxplot()

#interaction plot
dat %>%
  filter(Kind == "actual") %>%
  with(interaction.plot(x.factor = condition, trace.factor = Sabotage, 
                        response = Behaviors))

std <- function(x) sd(x)/sqrt(length(x))
dodge <- position_dodge(width = 0.9)

d <- dat %>% 
  group_by(condition, Kind, Sabotage) %>%
  summarize(Mean = mean(Behaviors), 
            SE = std(Behaviors)) 

# barplot of mean unethical behaviors across condition, kind and sabotage
d %>%
  ggplot(aes(x = interaction(Kind, condition), y = Mean, fill=Sabotage)) +
  geom_bar(position=position_dodge(), stat = "identity") +
  geom_errorbar(aes(ymax = Mean + SE, ymin = Mean - SE), position = dodge, width = 0.2) +
  annotate("text", x = 1:4, y = - 0.05,
           label = rep(c("Actual", "Deserve"), 2)) +
  annotate("text", c(1.5, 3.5), y = -0.2 , label = c("Agency", "Compliance"))  +
  theme(plot.margin = unit(c(1, 1, 4, 1), "lines"),
        axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        text=element_text(size=12,  family="sans")
  )

# barplot of Actual behavior across condition - primary result

d %>%
  filter(Kind == "actual") %>%
  ggplot(aes(x=condition, y=Mean, fill=Sabotage)) +
  geom_bar(stat="identity", position=position_dodge()) +
  geom_errorbar(aes(ymax = Mean + SE, ymin = Mean - SE),  position = dodge, width = 0.2)

# point-plot of summary statistics
d %>% 
  filter(Kind == "actual") %>%
  ggplot(aes(x = condition, y = Mean, group = Sabotage, color = Sabotage)) + 
  geom_point() + geom_line() #stat_summary(geom = "line")

# point plot but binned by within-participant variable Sabotage
d %>%
  filter(Kind == "actual") %>%
  ggplot(aes(x = Sabotage, y = Mean, group = condition, col = condition)) + 
  geom_point() + geom_line()

```

# Assumptions of ANOVA

Since our DV is a Likert-scale, it is expected that this dataset will violate the assumptions of an ANOVA, since its highly likely that data will not be normally distributed. Below some standard tests were performed to see if our data meets assumptions of two-way ANOVA

```{r}
# Outlier check
dat %>%
  group_by(condition, Sabotage) %>%
  identify_outliers(Behaviors) # Violated. 9 outliers, two of which are extreme

# Normality Check 1: Shapiro-Wilk test
dat %>%
  group_by(condition, Sabotage) %>% # if Normal, p-values are greater than 0.05
  shapiro_test(Behaviors) # Violated. All p-values are very low meaning data is non-normal. 

# Normality Check 2: QQ-Plots (for sample sizes > 50)
dat %>%
  ggqqplot("Behaviors", ggtheme = theme_bw()) +
  facet_grid(condition ~ Sabotage) # Violated. Highly non-normal behavior - should be linear

# Check for Homogeneity of Variance assumption of btn-subject factor (condition), at each within-subject level
dat %>%
  group_by(Sabotage) %>%
  levene_test(Behaviors ~ condition) # there is HOV since Levene's p-values>0.05. All groups have similar variance

# Check for Homogeneity of Covariances of between-subject factor (condition)
box_m(dat[, "Behaviors", drop = FALSE], dat$condition) # Box's M test p = 0.09 which is > 0.001 so we have equal covariances


datlong <- dat %>%
  pivot_wider(names_from = Sabotage, values_from = Behaviors)


```

# Confirmatory Analyses

## Two-way Mixed Effects Anova


```{r}

res.aov <- anova_test(
  data = dat, dv = Behaviors, wid = ResponseId,
  between = condition, within = Sabotage
  )
get_anova_table(res.aov) # There was a statistically significant main effect of Sabotage on unethical behaviors F(2, 588) = 7.93, p = 0.0004, effect size of 0.006 (essentially no effect). Effect of condition was non-significant (p = 0.1) and interaction effect was non-significant as well (p = 0.1). Gen effect size was 0.006 (very low). 

#============ Post-Hoc Tests =============== ##

# Simple Main Effect of Condition at each Sabotage level
## Effect of condition at each sabotage
dat %>%
  group_by(Sabotage) %>%
  anova_test(dv = Behaviors, wid = ResponseId, between = condition) %>%
  get_anova_table() %>%
  adjust_pvalue(method = "bonferroni") # Considering the Bonferroni adjusted p-value, it can be seen that the simple main effect of condition was significant at sab1 (p = 0.042) but not at sab2 (p = 1) and sab3 (p = 0.9).

## Pairwise comparisons between conditions
dat %>%
  group_by(Sabotage) %>%
  pairwise_t_test(Behaviors ~ condition, p.adjust.method = "bonferroni") # Pairwise comparisons show that the mean Behaviors were significantly different in condition 1 vs condition 2 comparison at Sabotage 1(p = 0.0137); but not in condition 1 vs condition 2 at Sab 2 (p = 0.408) and at Sab 3 (p = 0.314).

### Simple Main effects of Sabotage variable 
# Effect of Sabotage at each level of condition
dat %>%
  group_by(condition) %>%
  anova_test(dv = Behaviors, wid = ResponseId, within = Sabotage) %>%
  get_anova_table() %>%
  adjust_pvalue(method = "bonferroni") # There was a statistically significant effect of Sabotage on mean Behaviors for both conditions, condition 1 (p = 0.018) and condition 2 (p = 0.03). 

# Pairwise comparisons between condition at each Sabotage levels - Paired t-test is used because we have repeated measures by Sabotage
dat %>%
  group_by(condition) %>%
  pairwise_t_test(
    Behaviors ~ Sabotage, paired = TRUE, 
    p.adjust.method = "bonferroni"
    ) %>%
  dplyr::select(-df, -statistic, -p) #removes details ## Using pairwise paired t-test comparisons, it can be seen that for condition 1, the mean Behaviors were statistically significantly different between Sabotage 1 and 2(p = 0.018) and between Sabotage 2 and 3 (0.027). For condition 2 the means were not significantly different between Sabotage 1 and 2 (0.897) and Sabotage 1 and 3 (p = 0.215), but they were significantly different between Sabotage 2 and 3 (p = 0.013)

#NB: two way mixed ANOVA ha 3 null hypotheses - no difference in btn group variable, no difference in within grp variable, and no interaction effect


###==============REDO THIS ANOVA ON SPSS======================##



#The anova I just ran doesnt count because I my IVs were condition and sabotage but I ignored Kind. 
```

## Ordinal Logistic Regression

```{r}

#what do I have

# 5 categories in DV
# 2 discrete predictors: condition and Sabotage


#================ Tutorial source: https://stats.idre.ucla.edu/r/dae/ordinal-logistic-regression/ ===========#

datr <- dat %>%
    mutate_at(vars(Behaviors), factor) 
  

## Descriptive stats

#count
lapply(datr[, c("Behaviors", "condition", "Sabotage")], table)

#three way cross tabs (xtabs) and flatten the table
ftable(xtabs(~ condition + Behaviors + Sabotage, data = datr))

## fit ordered logit model and store results 'm'
m <- polr(Behaviors ~ condition + Sabotage, data = datr, Hess=TRUE) #hess = true gives you standard errors


## view a summary of the model
summary(m) #we have 5 intercepts corresponding to the 5 DV categories, but we aren't interested in that. Their intercept values just reflect the increasing odds as you look at probabilities of being in higher levels of categories. 

# logit (P(y<1) = -0.8 -)

## store table
(ctable <- coef(summary(m)))

p <- pnorm(abs(ctable[, "t value"]), lower.tail = FALSE) * 2

## combined table
(ctable <- cbind(ctable, "p value" = p))

## odds ratios
exp(coef(m))
##  pared public    gpa 
## 2.8511 0.9429 1.8514
## OR and CI
exp(cbind(OR = coef(m)))
##            OR  2.5 % 97.5 %
## pared  2.8511 1.6958  4.817
## public 0.9429 0.5209  1.681
## gpa    1.8514 1.1136  3.098
exp(cbind(OR = coef(m), confint(m)))


pred <- predict(m, datr[1:5,], type = 'prob')
print(pred, digits = 3)

#condition and sabotage 1-2 are statistically significant. 1 to 3 are not. 


##NULL HYPOTHESIS: NO signficant differene bewteen baseline model and final model

#How much variance in predictor explains variance in dependent variable
datr2 <- datr %>%
  filter(Kind == "actual")




```

# test
```{r}

get_anova_table(res.aov)

datlin <- dat %>%
  mutate_at(vars(ResponseId), factor) 

  mutate_at(vars(Behaviors), numeric)


linear <- lmer(Behaviors~condition + Sabotage + condition*Sabotage + (1|ResponseId), data = datlin)
anova(linear)

datlogistic <- datlin %>%
    mutate_at(vars(Behaviors), factor)
#tutorials: https://stackoverflow.com/questions/49103318/anova-function-when-comparing-logistic-models-has-no-p-value-for-deviance
#tutorial2: https://stats.stackexchange.com/questions/59879/logistic-regression-anova-chi-square-test-vs-significance-of-coefficients-ano


#1 - Main effect of condition
logistic0 <- clmm(Behaviors~ 1 + (1|ResponseId), data = datlogistic, link = "logit")
summary(logistic0)

logistic1 <- clmm(Behaviors~ condition + (1|ResponseId), data = datlogistic, link = "logit")
summary(logistic1)

anova(logistic0, logistic1) #'test' argument ignored in anova.clm


#2 - Main effect of Sabotage
logistic2 <- clmm(Behaviors~ Sabotage + (1|ResponseId), data = datlogistic, link = "logit")
summary(logistic2)

anova(logistic1, logistic2)

#3 - interaction effect
logistic3 <- clmm(Behaviors~ condition*Sabotage + (1|ResponseId), data = datlogistic, link = "logit")
summary(logistic3)

anova(logistic1, logistic2, logistic3)

# Now that you have simple main effects, time to do multiple comparisons post hoc

# tutorial1: https://stats.stackexchange.com/questions/60352/comparing-levels-of-factors-after-a-glm-in-r
#tutorial 2: https://stats.idre.ucla.edu/r/faq/how-can-i-test-contrasts-in-r/


##FINALLY I CAN SAY MY REGRESSION AND MY ANOVA AGREE RESULTS-WISE. PERRFECTT. THE FIGURES AREN"T EXACT BUT THE GENERAL SENTIMENT IS THE SAME. 
#NEXT UP< CLEAN CODE AND RE-PERFORM ANOVA ON "ACTUAL"-FILTERED DATA
```

# OLS PART 2

```{r}
#I"VE FIGURED IT OUT!!
#SOURCE: https://marissabarlaz.github.io/portfolio/ols/

# OLS IS a type of CLM model - cumulative link model. YOu can either use MASS package for polr() or clm() and clmm() in ordinal package. clmm() is for mixed effects so thats probabyl what i'm going for.

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

dattest2 %>%
ggplot(aes(x=interaction(condition, Sabotage), fill = Behaviors)) +
  geom_bar(position = "fill") + scale_fill_manual(values = cbPalette) + theme_minimal()

str(dat)



library(ordinal)


ols1 = clmm(Behaviors ~ condition + Sabotage + condition*Sabotage + (1|ResponseId) + (1|Sabotage), data = dattest2, link = "logit")
summary(ols1)

dattest3 <- dattest2 %>%
    mutate_at(vars(ResponseId), factor) 

anova(ols1, test = 'Chisq')

## ALSO GO BACK AND REMOVE EXTREME OUTLIERS THEN RERUN ANOVA


#Mad advice here: https://stats.stackexchange.com/questions/28938/why-do-linear-regression-and-anova-give-different-p-value-in-case-of-consideri. Do 2 models, one with and one without predictor then compare in anova() 

model12 = clmm(Behaviors ~ 1 + condition + Sabotage + condition*Sabotage + (1|ResponseId), data = dattest2, link = "logit")
summary(model12)

anova(model1, type = 3)


model2 = clmm(Behaviors ~ condition + (1|ResponseId), data = dattest3, link = "logit")
summary(model2)


anova(model1, model2)

options(contrasts=c("contr.sum","contr.poly"))
moD2 <- clmm(Behaviors ~ condition + Sabotage + condition*Sabotage + (1|ResponseId), data = dattest3, link = "logit")
summary(moD2)
anova(moD2)




```


 More logistic code
 
```{r}





logistic <- glm(Behaviors ~ condition, data = d, family = "binomial")
summary(logistic)

logistic2 <- glm(Behaviors ~ condition + Sabotage, data = d, family = "binomial")
summary(logistic2)

ll.null <- logistic2$null.deviance/-2
ll.proposed <- logistic2$deviance/-2
(ll.null - ll.proposed)/ll.null #overall ES = 0.0132


str(d)


####### SOMETHNING seems UP>>>DATA SEEMS TOO LONG>>>REDUCE IT IF I CAN
```

videos to watch
Stats quest: https://www.youtube.com/watch?v=C4N3_XJJ-jU&t=209s
Look up glm matrices
Setting and keeping contrasts: https://faculty.nps.edu/sebuttre/home/R/contrasts.html
Design matrices stats quest: https://www.youtube.com/watch?v=CqLGvwi-5Pc
Original tutorial: https://stats.idre.ucla.edu/r/dae/ordinal-logistic-regression/
Another logistic tutorial: https://stats.idre.ucla.edu/r/faq/ologit-coefficients/
Another tutorial: http://r-statistics.co/Ordinal-Logistic-Regression-With-R.html

```{r}
# convert Behaviors to ordered factor using as.ordered


#Ordinal logistic regression is also known as proportion odds logistic regression

# use library(MASS)
```

## END Notes


```{r}

## Google search shows there doesn't exist any non-parametric alternatives to 2-way ANOVA. Opinion is mixed but most seem to agree its still okay to do two-way ANOVA on Likert-type data like mine. See: https://journal.equinoxpub.com/JRDS/article/view/9482. So we will do ANOVA and then see if there are other alternatives. Looks like we could also do an ordinal logistic regression. 

# Another source has also indicated I can actually do an ANOVA despite my data being Likert type because 1) I have a valid zero-point in my DV, and 2) I have a valid constant separation between categories, so my variance is not meaningless. SOurce: look up "ANOVA for Likert type data". 


# some helpful links
# https://stackoverflow.com/questions/20060949/ggplot2-multiple-sub-groups-of-a-bar-chart


# examine Skewness of data
hist(dat_filt$Behaviors)

library(moments)
skewness(dat_filt$Behaviors, na.rm = TRUE) # skewness coefficient of 1.23. Skewness of >1 means data is highly skewed

# What kind of transformation do I need
    # Well, one that treats dependent variable as one of 5 "ranks". 
    # Kruskal-Wallis and Friedman handle only 1 factor of N levels, so cant be used to examine interaction effects. 
    # Also my dv is ordinal; cant be transformed w/log transform: https://depts.washington.edu/acelab/proj/art/index.html
# looks like I need to do either an (ordinal?) linear mixed effects regression or an ordinal logistic regression or an ART ANOVA(Aligned Rank Transformed ANOVA)

# linear mixed effects then plot residuals. Look at Kurtosis. Will violate normality but doesnt matter


```


